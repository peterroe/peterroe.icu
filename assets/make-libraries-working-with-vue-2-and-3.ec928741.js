import{_ as o}from"./Post.c7757a6b.js";import{j as i,k as r,g as l,o as u,a as e,i as t}from"./vendor.2adeb70a.js";import"./app.0a4f0146.js";const p=e("div",{class:"prose m-auto"},[e("p",null,[t("Today, Evan has announced that the first RC of Vue 3 "),e("a",{href:"https://github.com/vuejs/rfcs/issues/183",target:"_blank",rel:"noopener"},"will be released in mid-July"),t(". The post suggests library/plugin authors to start migrating the support for Vue 3. But as the APIs and behaviors have changed a lot, is that possible to make our libraries support Vue 2 and 3 at the same time?")]),e("h2",{id:"universal-code",tabindex:"-1"},[t("Universal Code "),e("a",{class:"header-anchor",href:"#universal-code","aria-hidden":"true"},"#")]),e("p",null,[t("The most simple way is to write universal code that works in both versions without any additional modification, just like people would do for "),e("a",{href:"https://python-future.org/compatible_idioms.html",target:"_blank",rel:"noopener"},"Python 2 and 3"),t(". Simple does not mean it\u2019s easy. Write such components requires you to avoid "),e("strong",null,"things that newly introduced in Vue 3"),t(" and "),e("strong",null,"things that deprecated from Vue 2"),t(". In other words, you can\u2019t use:")]),e("ul",null,[e("li",null,"Composition API"),e("li",null,[e("code",null,".sync"),t(),e("code",null,".native"),t(" modifiers")]),e("li",null,"Filters"),e("li",null,[e("a",{href:"/posts/vue-3-notes#-use-markraw-for-vendor-objects"},"3rd-parties vendor objects")]),e("li",null,"etc. (let me know if I missed anything and I will update the list)")]),e("p",null,"This just makes life harder and you can\u2019t benefit from the new awesome APIs in Vue 3."),e("h2",{id:"use-branches",tabindex:"-1"},[t("Use Branches "),e("a",{class:"header-anchor",href:"#use-branches","aria-hidden":"true"},"#")]),e("p",null,[e("a",{href:"https://github.com/vuejs/rfcs/issues/183#issuecomment-652134760",target:"_blank",rel:"noopener"},"A reply"),t(" to "),e("a",{href:"https://github.com/vuejs/rfcs/issues/183#issuecomment-651944231",target:"_blank",rel:"noopener"},"this problem"),t(" from a core team member suggests using different branches to separate your support for each targeting version. I think it\u2019s a good solution for existing and mature libraries as their codebases are usually more stable and version targeting optimization might require them to have better code isolations.")]),e("p",null,"The drawback of this is that you will need to maintain two codebases which double your workload. For small scale libraries or new libraries that want to support both versions, doing bugfix or feature supplements twice is just no ideal. I would not recommend using this approach at the very beginning of your projects."),e("h2",{id:"build-scripts",tabindex:"-1"},[t("Build Scripts "),e("a",{class:"header-anchor",href:"#build-scripts","aria-hidden":"true"},"#")]),e("p",null,[t("In "),e("a",{href:"https://github.com/antfu/vueuse",target:"_blank",rel:"noopener"},"VueUse"),t(", I wrote "),e("a",{href:"https://github.com/antfu/vueuse/tree/master/scripts",target:"_blank",rel:"noopener"},"some build scripts"),t(" to make the code imports from the target version\u2019s API while building. After that, I would need to publish two tags "),e("code",null,"vue2"),t(),e("code",null,"vue3"),t(" to distinguish different version supports. With this, I can wite the code once and make the library supports both Vue versions. The problem of it is that I need to build twice on each release and guide users to install with the corresponding plugin version (and manually install "),e("a",{href:"https://github.com/vuejs/composition-api",target:"_blank",rel:"noopener"},[e("code",null,"@vue/composition-api")]),t(" for Vue 2).")]),e("hr"),e("p",null,"It has been several months since I wrote VueUse. During this period, I am always trying to figure out a proper way to extract the logic from VueUse, so it can be reused and benefit other library authors. But after all, I still think it\u2019s just too complicated to be used in general."),e("p",null,"However, at the moment I started to write this post, I came up with the idea - providing the universal interface for both versions. If it works, in this way, authors are no need to worried about the users\u2019 environments anymore."),e("p",null,"And after some experiments\u2026"),e("h2",{id:"\u{1F3A9}-introducing-vue-demi",tabindex:"-1"},[t("\u{1F3A9} Introducing "),e("a",{href:"https://github.com/antfu/vue-demi",target:"_blank",rel:"noopener"},"Vue Demi"),t(),e("a",{class:"header-anchor",href:"#\u{1F3A9}-introducing-vue-demi","aria-hidden":"true"},"#")]),e("p",null,[e("a",{href:"https://github.com/antfu/vue-demi",target:"_blank",rel:"noopener"},[e("strong",null,"Vue Demi")]),t(" is a developing utility that allows you to write Universal Vue Libraries for Vue 2 and 3. Without worrying about users\u2019 installed versions.")]),e("p",null,[t("When you are going to create a Vue plugin/library, simply install "),e("code",null,"vue-demi"),t(" as your dependency and import anything related to Vue from it. Publish your plugin/library as usual, your package would become universal!")]),e("pre",{class:"language-json"},[e("code",{class:"language-json"},[e("span",{class:"token punctuation"},"{"),t(`
  `),e("span",{class:"token property"},'"dependencies"'),e("span",{class:"token operator"},":"),t(),e("span",{class:"token punctuation"},"{"),t(`
    `),e("span",{class:"token property"},'"vue-demi"'),e("span",{class:"token operator"},":"),t(),e("span",{class:"token string"},'"latest"'),t(`
  `),e("span",{class:"token punctuation"},"}"),t(`
`),e("span",{class:"token punctuation"},"}"),t(`
`)])]),e("pre",{class:"language-ts"},[e("code",{class:"language-ts"},[e("span",{class:"token keyword"},"import"),t(" Vue"),e("span",{class:"token punctuation"},","),t(),e("span",{class:"token punctuation"},"{"),t(" ref"),e("span",{class:"token punctuation"},","),t(" reactive "),e("span",{class:"token punctuation"},"}"),t(),e("span",{class:"token keyword"},"from"),t(),e("span",{class:"token string"},"'vue-demi'"),t(`
`)])]),e("p",null,[t("Underhood, it utilized the "),e("a",{href:"https://docs.npmjs.com/misc/scripts",target:"_blank",rel:"noopener"},[e("code",null,"postinstall"),t(" npm hook")]),t(". After all packages get installed, "),e("a",{href:"https://github.com/antfu/vue-demi/blob/master/scripts/postinstall.js",target:"_blank",rel:"noopener"},"the script"),t(" will start to check the installed Vue version and redirect the exports to based on the local Vue version. When working with Vue 2, it will also install "),e("code",null,"@vue/composition-api"),t(" automatically if it doesn\u2019t get installed.")]),e("p",null,[t("You can also check "),e("a",{href:"https://github.com/antfu/vue-demi/tree/master/examples",target:"_blank",rel:"noopener"},"the working examples"),t(", where I created a demo library "),e("a",{href:"https://github.com/antfu/vue-demi/blob/master/examples/%40vue-demi/use-mouse/src/index.ts",target:"_blank",rel:"noopener"},[e("code",null,"@vue-demi/use-mouse")]),t(" with just a single file entry.")]),e("p",null,"Please keep in mind that Vue Demi is experimental and there will definitely be some glitches. Feel free to give it a try and let me know if anything goes wrong."),e("p",null,"Thanks and happy hacking!")],-1),k={setup(d,{expose:a}){const n={draft:!1,title:"Make Libraries Working with Vue 2 and 3",description:"Try Vue Demi!",date:"2020-07-01T14:00:00.000Z",lang:"en",duration:"5min",meta:[{property:"og:title",content:"Make Libraries Working with Vue 2 and 3"},{property:"og:description",content:"Try Vue Demi!"},{name:"description",content:"Try Vue Demi!"}]};return a({frontmatter:n}),i({title:"Make Libraries Working with Vue 2 and 3",meta:[{property:"og:title",content:"Make Libraries Working with Vue 2 and 3"},{property:"og:description",content:"Try Vue Demi!"},{name:"description",content:"Try Vue Demi!"}]}),(c,m)=>{const s=o;return u(),r(s,{frontmatter:n},{default:l(()=>[p]),_:1})}}};export{k as default};
